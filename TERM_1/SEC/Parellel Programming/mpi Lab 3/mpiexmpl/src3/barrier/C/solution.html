<TITLE>A Solution to Benchmarking collective barrier</TITLE>
<BODY BGCOLOR="FFFFFF">
<PRE>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "mpi.h"

#define NUMBER_OF_TESTS 10

int main( argc, argv )
int argc;
char **argv;
{
    int          rank;
    int          size;
    double       t1, t2, tmin;
    int          j, k, nloop;

    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Init.html#MPI_Init">MPI_Init</A>( &amp;argc, &amp;argv );

    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</A>( MPI_COMM_WORLD, &amp;rank );
    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</A>( MPI_COMM_WORLD, &amp;size );
    if (rank == 0 &amp;&amp; size == 1) 
	printf( "Kind\tnp\ttime (sec)\n" );

    nloop = 1000;
    tmin  = 1000;
    for (k=0; k&lt;NUMBER_OF_TESTS; k++) {
	<A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</A>( MPI_COMM_WORLD );
	t1 = <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>();
	for (j=0; j&lt;nloop; j++) {
	    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</A>( MPI_COMM_WORLD );
	}
	t2 = (<A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>() - t1) / nloop;
	if (t2 &lt; tmin) tmin = t2;
    }

    if (rank == 0) {
	printf( "Barrier\t%d\t%f\n", size, tmin );
    }

    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</A>( );
    return 0;
}
</PRE>
</BODY>
