<TITLE>A Solution to Exploring the cost of synchronization delays</TITLE>
<BODY BGCOLOR="FFFFFF">
<PRE>
#include "mpi.h"
#include &lt;stdio.h&gt;

#define BIGSIZE 10000 
#define MAXLITSIZE     1024

int main( argc, argv )
int argc;
char *argv[];
{
    int myrank, numprocs;
    int i, tag = 50, litsize = 1;
    double bigdata[BIGSIZE];
    double litdata[MAXLITSIZE];
    double t1, ts1, ts2;
    MPI_Status status;
    MPI_Request request;

    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Init.html#MPI_Init">MPI_Init</A>( &amp;argc, &amp;argv);
    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</A>(MPI_COMM_WORLD,&amp;myrank);
    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</A>(MPI_COMM_WORLD,&amp;numprocs);

    if (numprocs &lt; 3) {
        fprintf(stderr, "%s must be run with at least %d processes\n",
                argv[0], 3);
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</A>( MPI_COMM_WORLD, 1 );
    }

    if (myrank == 0) {
	for (i=0; i&lt;argc; i++) {
	    if (!argv[i]) continue;
	    if (strcmp( argv[i], "-n" ) == 0) {
		litsize = atoi( argv[i+1] );
		i++;
	    }
	}
    }
    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Bcast.html#MPI_Bcast">MPI_Bcast</A>( &amp;litsize, 1, MPI_INT, 0, MPI_COMM_WORLD );

    for (i = 0; i &lt; BIGSIZE; i++)
        bigdata[i] = 1000;
    for (i = 0; i &lt; litsize; i++)
        litdata[i] =    1;
   
    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</A>(MPI_COMM_WORLD);

    if (myrank == 0) {
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Send.html#MPI_Send">MPI_Send</A>( bigdata, BIGSIZE, MPI_DOUBLE, 1, tag, MPI_COMM_WORLD);
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Recv.html#MPI_Recv">MPI_Recv</A>( litdata, litsize, MPI_DOUBLE, 2, tag, MPI_COMM_WORLD, &amp;status)
;
    }
    else if (myrank == 1) {
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Irecv.html#MPI_Irecv">MPI_Irecv</A>(litdata, litsize, MPI_DOUBLE, 2, tag, MPI_COMM_WORLD, &amp;request
);
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Send.html#MPI_Send">MPI_Send</A> (litdata, litsize, MPI_DOUBLE, 2, tag, MPI_COMM_WORLD);
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Recv.html#MPI_Recv">MPI_Recv</A>( bigdata, BIGSIZE, MPI_DOUBLE, 0, tag, MPI_COMM_WORLD, &amp;status)
;
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wait.html#MPI_Wait">MPI_Wait</A>( &amp;request, &amp;status );
    }
    else if (myrank == 2) {
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Recv.html#MPI_Recv">MPI_Recv</A>( litdata, litsize, MPI_DOUBLE, 1, tag, MPI_COMM_WORLD, &amp;status)
;
	t1 = <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>();
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Send.html#MPI_Send">MPI_Send</A>( litdata, litsize, MPI_DOUBLE, 1, tag, MPI_COMM_WORLD);
	ts1 = <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>() - t1;
	t1 = <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>();
        <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Send.html#MPI_Send">MPI_Send</A>( litdata, litsize, MPI_DOUBLE, 0, tag, MPI_COMM_WORLD);
	ts2 = <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</A>() - t1;
    }

    if (myrank == 2) {
	printf( 
"[%d] Litsize = %d, Time for first send = %f, for second = %f\n", 
		myrank, litsize, ts1, ts2  );
    }

    <A href="http://www.mcs.anl.gov/mpi/www/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</A>();
    return 0;
}
</PRE>
</BODY>
